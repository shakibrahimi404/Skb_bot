import json
import os
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import ApplicationBuilder, CommandHandler, ContextTypes, MessageHandler, filters

USERS_FILE = "users.json"

# Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
def load_users():
    if not os.path.exists(USERS_FILE):
        with open(USERS_FILE, "w") as f:
            json.dump({}, f)
    with open(USERS_FILE, "r") as f:
        return json.load(f)

# Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
def save_users(data):
    with open(USERS_FILE, "w") as f:
        json.dump(data, f)

TOKEN = "ØªÙˆÚ©Ù†_Ø±Ø¨Ø§Øª_ØªÙˆ_Ø§ÛŒÙ†Ø¬Ø§_Ø¨Ø²Ø§Ø±"  # Ø§ÛŒÙ†Ùˆ Ø¨Ø§ ØªÙˆÚ©Ù† Ø®ÙˆØ¯Øª Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user = update.effective_user
    users = load_users()
    if str(user.id) not in users:
        users[str(user.id)] = {"coins": 0}
        save_users(users)
    keyboard = InlineKeyboardMarkup([
        [InlineKeyboardButton("ğŸ’° Ù…Ø§ÛŒÙ† Ø³Ú©Ù‡", web_app={"url": "https://yourproject.up.railway.app"})]
    ])
    await update.message.reply_text(f"Ø³Ù„Ø§Ù… {user.first_name}! Ø¨Ù‡ NatCoin Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒ.", reply_markup=keyboard)

async def handle_data(update: Update, context: ContextTypes.DEFAULT_TYPE):
    data = update.message.text
    users = load_users()
    user_id = str(update.effective_user.id)

    if data.startswith("ADD_COINS_"):
        amount = int(data.split("_")[-1])
        users[user_id]["coins"] += amount
        save_users(users)
        await update.message.reply_text(f"ğŸŒŸ {amount} Ø³Ú©Ù‡ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ Ø§ÙØ²ÙˆØ¯Ù‡ Ø´Ø¯! Ù…Ø¬Ù…ÙˆØ¹: {users[user_id]['coins']}")

if __name__ == "__main__":
    app = ApplicationBuilder().token(TOKEN).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & (~filters.COMMAND), handle_data))
    print("Ø±Ø¨Ø§Øª Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§Ø³Øª...")
    app.run_polling()
